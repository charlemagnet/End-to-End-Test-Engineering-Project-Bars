<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Center Rezervasyon</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 400px; }
        h2 { text-align: center; color: #2c3e50; }
        .tab { display: flex; justify-content: space-around; margin-bottom: 20px; border-bottom: 2px solid #eee; }
        .tab button { background: none; border: none; padding: 10px; cursor: pointer; font-size: 14px; color: #7f8c8d; font-weight: bold; }
        .tab button.active { color: #3498db; border-bottom: 2px solid #3498db; }
        .tab button.active-cancel { color: #e74c3c; border-bottom: 2px solid #e74c3c; } /* Ä°ptal iÃ§in kÄ±rmÄ±zÄ± stil */
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #34495e; font-size: 0.9em; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        button.action-btn { width: 100%; padding: 10px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; transition: background 0.3s; }
        button.action-btn:hover { background-color: #2980b9; }
        
        button.cancel-btn { background-color: #e74c3c; }
        button.cancel-btn:hover { background-color: #c0392b; }

        #message { margin-top: 15px; padding: 10px; border-radius: 5px; display: none; text-align: center; font-size: 14px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #cce5ff; color: #004085; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ‹ï¸ Fitness Center</h2>
    
    <div class="tab">
        <button class="active" onclick="showTab('register')">KayÄ±t Ol</button>
        <button onclick="showTab('booking')">Rezervasyon</button>
        <button onclick="showTab('cancel')">Ä°ptal Et</button> </div>

    <div id="register-section">
        <div class="form-group">
            <label>Ad Soyad</label>
            <input type="text" id="regName" placeholder="Ã–rn: Ali Veli">
        </div>
        <div class="form-group">
            <label>Ãœyelik Tipi</label>
            <select id="regType">
                <option value="Yoga">Yoga</option>
                <option value="Boxing">Boxing</option>
                <option value="Fitness">Fitness</option>
                <option value="Basketball">Basketball</option>
                <option value="Tenis">Tenis</option>
                <option value="Swimming">Swimming</option>
            </select>
        </div>
        <button class="action-btn" onclick="registerMember()">Ãœye Ol</button>
    </div>

    <div id="booking-section" class="hidden">
        <div class="form-group">
            <label>Ãœye ID (Member ID)</label>
            <input type="number" id="bookMemberId" placeholder="KayÄ±t sonrasÄ± verilen ID">
        </div>
        <div class="form-group">
            <label>Ders SeÃ§in</label>
            <select id="bookClass">
                <option value="Yoga">Yoga ($200)</option>
                <option value="Boxing">Boxing ($120)</option>
                <option value="Fitness">Fitness ($80)</option>
                <option value="Basketball">Basketball ($40)</option>
                <option value="Tenis">Tenis ($90)</option>
                <option value="Swimming">Swimming ($30)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Tarih</label>
            <input type="date" id="bookDate">
        </div>
        <div class="form-group">
            <label>Saat (0-23)</label>
            <input type="number" id="bookHour" min="6" max="23" placeholder="Ã–rn: 14">
        </div>
        <button class="action-btn" style="background-color: #27ae60;" onclick="makeReservation()">Rezervasyon Yap</button>
    </div>

    <div id="cancel-section" class="hidden">
        <div class="form-group">
            <label style="color:#c0392b">Ä°ptal Edilecek Rezervasyon ID</label>
            <input type="number" id="cancelResId" placeholder="Rezervasyon ID girin">
            <small style="color:#666; font-size:11px;">Rezervasyon yapÄ±nca size verilen ID</small>
        </div>
        <div class="form-group">
            <label>KaÃ§ kere giriÅŸ yapÄ±ldÄ±?</label>
            <input type="number" id="entrancesUsed" value="0" min="0">
            <small style="color:#666; font-size:11px;">Ä°ade oranÄ±nÄ± etkiler (2 giriÅŸten az ise %100 iade)</small>
        </div>
        <button class="action-btn cancel-btn" onclick="cancelReservation()">Rezervasyonu Ä°ptal Et</button>
    </div>

    <div id="message"></div>
</div>

<script>
    const API_URL = "http://127.0.0.1:8000";

    function showTab(tabName) {
        // TÃ¼m bÃ¶lÃ¼mleri gizle
        document.getElementById('register-section').classList.add('hidden');
        document.getElementById('booking-section').classList.add('hidden');
        document.getElementById('cancel-section').classList.add('hidden');
        
        // Tab renklerini sÄ±fÄ±rla
        const buttons = document.querySelectorAll('.tab button');
        buttons.forEach(btn => {
            btn.classList.remove('active');
            btn.classList.remove('active-cancel');
        });

        // Ä°lgili bÃ¶lÃ¼mÃ¼ aÃ§
        if(tabName === 'register') {
            document.getElementById('register-section').classList.remove('hidden');
            buttons[0].classList.add('active');
        } else if (tabName === 'booking') {
            document.getElementById('booking-section').classList.remove('hidden');
            buttons[1].classList.add('active');
        } else {
            document.getElementById('cancel-section').classList.remove('hidden');
            buttons[2].classList.add('active-cancel');
        }
        hideMessage();
    }

    async function registerMember() {
        const name = document.getElementById('regName').value;
        const type = document.getElementById('regType').value;

        try {
            const response = await fetch(`${API_URL}/members`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, membership_type: type })
            });
            const data = await response.json();
            
            if (response.ok) {
                showMessage(`âœ… KayÄ±t BaÅŸarÄ±lÄ±! Ãœye ID: <b>${data.member_id}</b> <br> (Bunu not edin!)`, 'success');
                document.getElementById('bookMemberId').value = data.member_id; 
            } else {
                showMessage(`âŒ Hata: ${data.detail}`, 'error');
            }
        } catch (error) {
            showMessage(`âŒ BaÄŸlantÄ± HatasÄ±: ${error}`, 'error');
        }
    }

    async function makeReservation() {
        const memberId = document.getElementById('bookMemberId').value;
        const classType = document.getElementById('bookClass').value;
        const date = document.getElementById('bookDate').value;
        const hour = document.getElementById('bookHour').value;

        try {
            const response = await fetch(`${API_URL}/reservations`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    member_id: parseInt(memberId), 
                    class_type: classType, 
                    date: date, 
                    hour: parseInt(hour) 
                })
            });
            const data = await response.json();

            if (response.ok) {
                // MongoDB _id string olarak gelebilir, onu alÄ±yoruz
                let resId = data.id || data._id; 
                showMessage(`ğŸ‰ Rezervasyon NO: <b>${resId}</b> <br> Fiyat: $${data.price} <br> (Ä°ptal iÃ§in bu numarayÄ± saklayÄ±n)`, 'success');
                // Ä°ptal sekmesine otomatik doldur
                document.getElementById('cancelResId').value = resId;
            } else {
                showMessage(`âš ï¸ BaÅŸarÄ±sÄ±z: ${data.detail}`, 'error');
            }
        } catch (error) {
            showMessage(`âŒ BaÄŸlantÄ± HatasÄ±: ${error}`, 'error');
        }
    }

    async function cancelReservation() {
        const resId = document.getElementById('cancelResId').value;
        const entrances = document.getElementById('entrancesUsed').value;

        if (!resId) {
            showMessage("LÃ¼tfen Rezervasyon ID giriniz.", "error");
            return;
        }

        try {
            // DELETE isteÄŸi atÄ±yoruz
            const response = await fetch(`${API_URL}/reservations/${resId}?entrances_used=${entrances}`, {
                method: 'DELETE'
            });
            const data = await response.json();

            if (response.ok) {
                showMessage(`ğŸ—‘ï¸ Ä°ptal BaÅŸarÄ±lÄ±! <br> Ä°ade TutarÄ±: <b>$${data.refund_amount}</b>`, 'info');
            } else {
                showMessage(`âŒ Ä°ptal Edilemedi: ${data.detail}`, 'error');
            }
        } catch (error) {
            showMessage(`âŒ BaÄŸlantÄ± HatasÄ±: ${error}`, 'error');
        }
    }

    function showMessage(html, type) {
        const msgDiv = document.getElementById('message');
        msgDiv.style.display = 'block';
        msgDiv.innerHTML = html;
        msgDiv.className = type;
    }

    function hideMessage() {
        document.getElementById('message').style.display = 'none';
    }
    
    document.getElementById('bookDate').valueAsDate = new Date();
</script>

</body>
</html>